<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="After_PrepareBuildProperties" AfterTargets="PrepareBuildProperties">
    <PropertyGroup>
      <BuildProperties>
        $(BuildProperties);
        DatabaseNamePrefix=$(DatabaseNamePrefix);
      </BuildProperties>

      <BuildProperties>
        $(BuildProperties);
        DataSourceMsSql2012=$(DataSourceMsSql2012);
        DataSourceMsSql2014=$(DataSourceMsSql2014);
        DataSourceMsSql2016=$(DataSourceMsSql2016);
        DataSourceMsSql2017=$(DataSourceMsSql2017);
      </BuildProperties>

      <BuildProperties>
        $(BuildProperties);
        DatabaseDirectoryMsSql2012=$(DatabaseDirectoryMsSql2012);
        DatabaseDirectoryMsSql2014=$(DatabaseDirectoryMsSql2014);
        DatabaseDirectoryMsSql2016=$(DatabaseDirectoryMsSql2016);
        DatabaseDirectoryMsSql2017=$(DatabaseDirectoryMsSql2017);
      </BuildProperties>

      <BuildProperties>
        $(BuildProperties);
        IntegratedSecurityMsSql2012=$(IntegratedSecurityMsSql2012);
        IntegratedSecurityMsSql2014=$(IntegratedSecurityMsSql2014);
        IntegratedSecurityMsSql2016=$(IntegratedSecurityMsSql2016);
        IntegratedSecurityMsSql2017=$(IntegratedSecurityMsSql2017);
      </BuildProperties>

      <BuildProperties>
        $(BuildProperties);
        UsernameMsSql2012=$(UsernameMsSql2012);
        UsernameMsSql2014=$(UsernameMsSql2014);
        UsernameMsSql2016=$(UsernameMsSql2016);
        UsernameMsSql2017=$(UsernameMsSql2017);
      </BuildProperties>

      <BuildProperties>
        $(BuildProperties);
        PasswordMsSql2012=$(PasswordMsSql2012);
        PasswordMsSql2014=$(PasswordMsSql2014);
        PasswordMsSql2016=$(PasswordMsSql2016);
        PasswordMsSql2017=$(PasswordMsSql2017);
      </BuildProperties>
    </PropertyGroup>

    <Message Text="Configured build properties: $(BuildProperties)" />
  </Target>

  <Target Name="After_CreateTestConfigurations" AfterTargets="CreateTestConfigurations">
    <ItemGroup>
      <AllDatabaseSystems Remove="@(AllDatabaseSystems)" />

      <AllDatabaseSystems Include="SqlServerDefault" Condition="'%(DatabaseSystemsList.Identity)' == 'SqlServerDefault'"/>
      <AllDatabaseSystems Include="SqlServer2012" Condition="'%(DatabaseSystemsList.Identity)' == 'SqlServer2012'"/>
      <AllDatabaseSystems Include="SqlServer2014" Condition="'%(DatabaseSystemsList.Identity)' == 'SqlServer2014'"/>
      <AllDatabaseSystems Include="SqlServer2016" Condition="'%(DatabaseSystemsList.Identity)' == 'SqlServer2016'"/>
      <AllDatabaseSystems Include="SqlServer2017" Condition="'%(DatabaseSystemsList.Identity)' == 'SqlServer2017'"/>
    </ItemGroup>

    <ItemGroup>
      <AllBrowsers Remove="@(AllBrowsers)"/>

      <AllBrowsers Include="Chrome" Condition="'%(BrowsersList.Identity)' == 'Chrome'" />
      <AllBrowsers Include="Edge" Condition="'%(BrowsersList.Identity)' == 'Edge'" />
      <AllBrowsers Include="Firefox" Condition="'%(BrowsersList.Identity)' == 'Firefox'" />
      <AllBrowsers Include="InternetExplorer" Condition="'%(BrowsersList.Identity)' == 'InternetExplorer'" />
    </ItemGroup>
  </Target>

  <Target Name="After_BuildTestOutputFilesCrossProduct" AfterTargets="BuildTestOutputFilesCrossProduct">
    <ItemGroup>
      <_testOutputFilesWithWebTests Include="@(TestOutputFiles)" Condition="'%(IsWebTest)' == 'True'"/>

      <_testOutputFilesWithInternetExplorer Include="@(_testOutputFiles)" Condition="'%(Browser)' == 'InternetExplorer'"/>
      <_testOutputFilesWithFirefox Include="@(_testOutputFiles)" Condition="'%(Browser)' == 'Firefox'"/>
      <_testOutputFilesWithChrome Include="@(_testOutputFiles)" Condition="'%(Browser)' == 'Chrome'"/>
      <_testOutputFilesWithEdge Include="@(_testOutputFiles)" Condition="'%(Browser)' == 'Edge'"/>
    </ItemGroup>

    <ItemGroup Condition="'@(_testOutputFilesWithInternetExplorer->Count())' &gt; '@(_testOutputFilesWithWebTests->Count())'">
      <_testOutputFiles Remove="@(_testOutputFiles)" Condition="'%(Browser)' == 'InternetExplorer' And ('%(Platform)' != 'x86' Or '$(ConfigurationID)' != 'Release')"/>
    </ItemGroup>

    <ItemGroup Condition="'@(_testOutputFilesWithFirefox->Count())' &gt; '@(_testOutputFilesWithWebTests->Count())'">
      <_testOutputFiles Remove="@(_testOutputFiles)" Condition="'%(Browser)' == 'Firefox' And ('%(Platform)' != 'x64' Or '$(ConfigurationID)' != 'Debug')"/>
    </ItemGroup>

    <ItemGroup Condition="'@(_testOutputFilesWithChrome->Count())' &gt; '@(_testOutputFilesWithWebTests->Count())'">
      <_testOutputFiles Remove="@(_testOutputFiles)" Condition="'%(Browser)' == 'Chrome' And ('%(Platform)' != 'x64' Or '$(ConfigurationID)' != 'Release')"/>
    </ItemGroup>

    <ItemGroup Condition="'@(_testOutputFilesWithEdge->Count())' &gt; '@(_testOutputFilesWithWebTests->Count())'">
      <_testOutputFiles Remove="@(_testOutputFiles)" Condition="'%(Browser)' == 'Edge' And ('%(Platform)' != 'x86' Or '$(ConfigurationID)' != 'Debug')"/>
    </ItemGroup>

  </Target>
</Project>